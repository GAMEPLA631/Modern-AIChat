<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moderný AI Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #121212;
            color: #e0e0e0;
        }
        .chat-container {
            max-width: 600px;
            width: 95%;
            height: 90vh;
            display: flex;
            flex-direction: column;
            background-color: #1e1e1e;
        }
        .chat-history {
            flex-grow: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            padding: 1rem;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .chat-history::-webkit-scrollbar {
            display: none;
        }
        .message {
            max-width: 80%;
            padding: 0.75rem 1rem;
            border-radius: 1.5rem;
            font-size: 0.95rem;
            line-height: 1.5;
            word-wrap: break-word;
            animation: pulse-animation 1s infinite alternate;
        }
        .user-message {
            align-self: flex-end;
            border-bottom-right-radius: 0.5rem;
            background-color: #3b82f6;
            color: white;
        }
        .ai-message {
            align-self: flex-start;
            border-bottom-left-radius: 0.5rem;
            background-color: #2e2e2e;
        }
        .message-loader {
            background-color: #333333;
            color: #b0b0b0;
            font-style: italic;
            align-self: flex-start;
            animation: none;
        }
        .input-area {
            display: flex;
            gap: 0.5rem;
        }
        #text-input {
            flex-grow: 1;
            background-color: #2a2a2a;
            color: white;
            border-color: #4a4a4a;
        }
        #text-input::placeholder {
            color: #a0a0a0;
        }
        #generate-button {
            background-color: #007acc;
            color: white;
            transition: background-color 0.3s ease-in-out;
        }
        #generate-button:hover {
            background-color: #005f99;
        }
        .header-title {
            animation: title-color-change 5s infinite linear;
        }

        /* Animácie */
        @keyframes title-color-change {
            0% { color: #8a2be2; }
            25% { color: #ff6347; }
            50% { color: #32cd32; }
            75% { color: #1e90ff; }
            100% { color: #8a2be2; }
        }

        @keyframes pulse-animation {
            0% { transform: scale(1); }
            100% { transform: scale(1.01); }
        }
    </style>
</head>
<body class="bg-gray-900 flex items-center justify-center min-h-screen p-4">

    <div class="chat-container bg-gray-800 rounded-xl shadow-2xl overflow-hidden">
        <div class="p-4 bg-gray-700 border-b border-gray-600">
            <h1 class="header-title text-3xl font-bold text-center">AI Chatbot</h1>
            <p class="text-sm text-center text-gray-400 mt-1">Generujte texty pre rôzne platformy.</p>
        </div>

        <div id="chat-history" class="chat-history">
            <div class="message ai-message">
                Ahoj! Vyberte si typ obsahu a napíšte mi, o čom má byť. Napríklad, ak chcete pieseň, napíšte "láska".
            </div>
        </div>

        <div class="p-4 bg-gray-700 border-t border-gray-600">
            <div class="flex flex-col sm:flex-row gap-4 mb-4">
                <select id="content-type" class="w-full sm:w-1/3 p-3 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 bg-gray-800 text-white">
                    <option value="song-lyrics">Text piesne</option>
                    <option value="youtube-description">Popis na YouTube</option>
                    <option value="other-description">Popis na iné platformy</option>
                    <option value="story">Príbeh</option>
                    <option value="roblox-name">Názvy hier na Roblox</option>
                    <option value="youtube-title">Názvy videí na YouTube</option>
                </select>
                <input type="text" id="text-input" placeholder="Zadajte svoju tému..." class="w-full sm:w-2/3 p-3 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300">
            </div>
            <div class="input-area">
                <button id="generate-button" class="w-full p-3 rounded-lg bg-teal-500 text-white font-semibold shadow-lg hover:bg-teal-600 transition-all duration-300 transform hover:scale-105 active:scale-95">
                    Generovať
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        // Váš Gemini API kľúč. Vložte ho sem.
        const apiKey = 'AIzaSyAzWkdCBiqlrFZODs2zEichlIWe68Wo2eI';
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        const chatHistory = document.getElementById('chat-history');
        const textInput = document.getElementById('text-input');
        const generateButton = document.getElementById('generate-button');
        const contentTypeSelect = document.getElementById('content-type');

        // Funkcia na zobrazenie správy v chate
        function displayMessage(text, sender) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message');
            messageElement.classList.add(sender === 'user' ? 'user-message' : 'ai-message');
            messageElement.innerHTML = text.replace(/\n/g, '<br>');
            chatHistory.appendChild(messageElement);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        // Funkcia na zobrazenie načítavacej správy
        function showLoader() {
            const loaderElement = document.createElement('div');
            loaderElement.id = 'loader-message';
            loaderElement.classList.add('message', 'message-loader');
            loaderElement.textContent = 'Generuje sa...';
            chatHistory.appendChild(loaderElement);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        // Funkcia na skrytie načítavacej správy
        function hideLoader() {
            const loaderElement = document.getElementById('loader-message');
            if (loaderElement) {
                loaderElement.remove();
            }
        }

        // Hlavná funkcia pre generovanie obsahu
        async function generateContent() {
            const userText = textInput.value.trim();
            const selectedType = contentTypeSelect.value;
            
            // Kontrola, či bol vložený API kľúč
            if (apiKey === 'YOUR_API_KEY_HERE' || apiKey.length < 10) {
                displayMessage('Chyba: Vložte prosím platný Gemini API kľúč do kódu.', 'ai');
                generateButton.disabled = false;
                return;
            }

            if (userText === '') {
                return;
            }

            displayMessage(userText, 'user');
            textInput.value = '';
            showLoader();
            generateButton.disabled = true;

            let systemPrompt = "Správaj sa ako užitočný asistent. Poskytni dobre naformátovanú odpoveď s jasnými sekciami, ale nepoužívaj nadpisy a iné špeciálne znaky Markdown. Odpoveď by mala byť priateľská a štruktúrovaná jednoduchým textom.";
            let userQuery;

            switch (selectedType) {
                case 'song-lyrics':
                    // Pokročilá požiadavka na text piesne s konkrétnou štruktúrou
                    userQuery = `Napíš text piesne v štýle, ako ste zadali, so sekciami ako [Intro], [Verse], [Build-up], [Drop], [Verse], [Bridge], [Final Build], [Final Drop]. Téma piesne: ${userText}. Texty by mali byť plné energie, s odkazmi na basy, rytmus a temnú, chytľavú atmosféru.`;
                    break;
                case 'youtube-description':
                    userQuery = `Napíš podrobný a chytľavý popis videa na YouTube o téme: ${userText}`;
                    break;
                case 'other-description':
                    userQuery = `Vytvor popis pre sociálne siete alebo iné platformy o téme: ${userText}`;
                    break;
                case 'story':
                    userQuery = `Napíš pútavý krátky príbeh o téme: ${userText}`;
                    break;
                case 'roblox-name':
                    userQuery = `Vytvor kreatívne a chytľavé názvy pre hry na Roblox o téme: ${userText}`;
                    break;
                case 'youtube-title':
                    userQuery = `Vytvor zaujímavé a chytľavé názvy pre videá na YouTube o téme: ${userText}`;
                    break;
                default:
                    userQuery = userText;
                    break;
            }
            
            // Konštrukcia API požiadavky
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                }
            };

            // Pokus o volanie API s exponenciálnym spätným poklesom
            let response;
            let attempt = 0;
            const maxAttempts = 5;
            while (attempt < maxAttempts) {
                try {
                    response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        break;
                    } else if (response.status === 429) {
                        const delay = Math.pow(2, attempt) * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        attempt++;
                    } else {
                        throw new Error(`Chyba API: ${response.statusText}`);
                    }
                } catch (error) {
                    console.error('Fetch error:', error);
                    displayMessage(`Nastala chyba pri generovaní. Skúste to znova.`, 'ai');
                    hideLoader();
                    generateButton.disabled = false;
                    return;
                }
            }

            if (!response || !response.ok) {
                displayMessage('Nastala chyba pri volaní API po niekoľkých pokusoch. Skúste to prosím neskôr.', 'ai');
                hideLoader();
                generateButton.disabled = false;
                return;
            }

            const result = await response.json();
            hideLoader();

            if (result.candidates && result.candidates.length > 0) {
                const generatedText = result.candidates[0].content.parts[0].text;
                displayMessage(generatedText, 'ai');
            } else {
                displayMessage('Prepáčte, nepodarilo sa mi vygenerovať text. Skúste to prosím s inou témou.', 'ai');
            }
            
            generateButton.disabled = false;
        }

        generateButton.addEventListener('click', generateContent);
        textInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !generateButton.disabled) {
                generateContent();
            }
        });
    </script>

</body>
</html>
